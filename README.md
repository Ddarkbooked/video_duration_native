# video_duration_native

[![Very Good Ventures][logo_white]][very_good_ventures_link_dark]
[![Very Good Ventures][logo_black]][very_good_ventures_link_light]

Developed with üíô by [Very Good Ventures][very_good_ventures_link] ü¶Ñ

![coverage][coverage_badge]
[![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link]
[![License: MIT][license_badge]][license_link]

A lightweight native video duration reader for Flutter that works on Android and iOS. No FFmpeg, no byte loading‚Äîjust native platform APIs for fast, efficient video metadata extraction.

Generated by the [Very Good CLI][very_good_cli_link]. ü§ñ

## Features

‚úÖ **Lightweight** - Uses native platform APIs only (no FFmpeg dependencies)  
‚úÖ **Fast** - Reads metadata without loading video data into memory  
‚úÖ **Cross-platform** - Works on both Android and iOS  
‚úÖ **Content URI support** - Android content:// URIs supported  
‚úÖ **Error handling** - Returns Duration.zero on errors  
‚úÖ **Type-safe** - Returns Dart Duration object

## Platform Support

| Platform | Implementation | Supported Paths |
|----------|---------------|-----------------|
| Android | `MediaMetadataRetriever` | File paths, content:// URIs |
| iOS | `AVURLAsset` | File paths, file:// URLs |

## Installation

Add this to your package's `pubspec.yaml` file:

```yaml
dependencies:
  video_duration_native: ^0.1.0
```

## Usage

```dart
import 'package:video_duration_native/video_duration_native.dart';

// Get duration from a file path
final duration = await getDuration('/path/to/video.mp4');
print('Video duration: ${duration.inSeconds} seconds');

// Android content URI
final duration2 = await getDuration('content://media/external/video/123');

// Returns Duration.zero on error or invalid path
final invalid = await getDuration('/invalid/path.mp4');
print(invalid); // Duration: 0:00:00.000000
```

## Example with File Picker

```dart
import 'package:file_picker/file_picker.dart';
import 'package:video_duration_native/video_duration_native.dart';

Future<void> pickAndGetDuration() async {
  final result = await FilePicker.platform.pickFiles(
    type: FileType.video,
  );

  if (result != null && result.files.isNotEmpty) {
    final path = result.files.first.path;
    if (path != null) {
      final duration = await getDuration(path);
      print('Duration: ${duration.inSeconds} seconds');
      print('Milliseconds: ${duration.inMilliseconds} ms');
    }
  }
}
```

## How It Works

### Android (MediaMetadataRetriever)

The Android implementation uses `MediaMetadataRetriever` to extract video metadata:

- Supports both file paths and content URIs
- Lightweight metadata extraction
- Automatic resource cleanup
- Returns duration in milliseconds

### iOS (AVURLAsset)

The iOS implementation uses `AVURLAsset` with optimized settings:

- `preloadsEligibleContentKeys = false` - Avoids loading tracks into memory
- `prefersPreciseDurationAndTiming = true` - Ensures accurate duration (iOS 13+)
- Supports file paths and URLs
- Returns duration in milliseconds

## Testing

This plugin uses [Fluttium][fluttium_link] for integration tests. For detailed testing information, see [TESTING.md](TESTING.md).

### Quick Start

```bash
# Run unit tests
cd video_duration_native
flutter test

# Run integration tests
cd video_duration_native/example
flutter test integration_test/app_test.dart

# Run Fluttium E2E tests
cd video_duration_native/example
fluttium test flows/test_platform_name.yaml
fluttium test flows/test_get_duration.yaml
```

**‚ùó To run Fluttium tests, you need `fluttium_cli` installed. [See how][fluttium_install].**

## Example App

The example app demonstrates all plugin features:

- Get platform name
- Pick video files using native file picker
- Get video duration with manual path input
- Display duration in seconds and milliseconds

```bash
cd video_duration_native/example
flutter run
```

## Release Management

This project uses [release-please](https://github.com/googleapis/release-please) for automated version management and changelog generation. The workflow:

- Monitors commits to the `main` branch
- Automatically generates changelog entries based on conventional commits
- Creates release PRs when changes are ready
- Publishes releases to GitHub and pub.dev

**Conventional Commits:**
- `feat:` - New features (minor version bump)
- `fix:` - Bug fixes (patch version bump)
- `BREAKING CHANGE:` - Breaking changes (major version bump)

[coverage_badge]: video_duration_native/coverage_badge.svg
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[logo_black]: https://raw.githubusercontent.com/VGVentures/very_good_brand/main/styles/README/vgv_logo_black.png#gh-light-mode-only
[logo_white]: https://raw.githubusercontent.com/VGVentures/very_good_brand/main/styles/README/vgv_logo_white.png#gh-dark-mode-only
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[very_good_cli_link]: https://github.com/VeryGoodOpenSource/very_good_cli
[very_good_ventures_link]: https://verygood.ventures/?utm_source=github&utm_medium=banner&utm_campaign=core
[very_good_ventures_link_dark]: https://verygood.ventures/?utm_source=github&utm_medium=banner&utm_campaign=core#gh-dark-mode-only
[very_good_ventures_link_light]: https://verygood.ventures/?utm_source=github&utm_medium=banner&utm_campaign=core#gh-light-mode-only
[fluttium_link]: https://fluttium.dev/
[fluttium_install]: https://fluttium.dev/docs/getting-started/installing-cli
